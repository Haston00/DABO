{% extends "base.html" %}

{% block title %}DABO — Dashboard{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
{% endblock %}

{% block body %}
<div class="flex h-screen overflow-hidden">

    <!-- ═══ SIDEBAR ═══ -->
    <aside class="sidebar w-64 flex-shrink-0 flex flex-col" id="sidebar">
        <!-- Logo -->
        <div class="px-6 pt-6 pb-3 text-center">
            <div class="text-4xl font-black text-orange tracking-tighter leading-none">DABO</div>
            <div class="text-[10px] text-cream/40 tracking-[3px] uppercase mt-1">Plan Review Engine</div>
            <div class="w-10 h-0.5 bg-orange mx-auto mt-3 rounded-full"></div>
        </div>

        <div class="sidebar-divider"></div>

        <!-- Nav links -->
        <nav class="flex-1 px-3 py-2 space-y-0.5 overflow-y-auto">
            <a href="/dashboard/projects" class="nav-link {% if page == 'projects' %}active{% endif %}" data-page="projects">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                <span>Projects</span>
            </a>
            <a href="/dashboard/ingestion" class="nav-link {% if page == 'ingestion' %}active{% endif %}" data-page="ingestion">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                <span>PDF Ingestion</span>
            </a>
            <a href="/dashboard/sheets" class="nav-link {% if page == 'sheets' %}active{% endif %}" data-page="sheets">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                <span>Sheet Index</span>
            </a>
            <a href="/dashboard/review" class="nav-link {% if page == 'review' %}active{% endif %}" data-page="review">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                <span>Plan Review</span>
            </a>
            <a href="/dashboard/rfis" class="nav-link {% if page == 'rfis' %}active{% endif %}" data-page="rfis">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>RFI Log</span>
            </a>
            <a href="/dashboard/schedule" class="nav-link {% if page == 'schedule' %}active{% endif %}" data-page="schedule">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                <span>Schedule</span>
            </a>
            <a href="/dashboard/exports" class="nav-link {% if page == 'exports' %}active{% endif %}" data-page="exports">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                <span>Export Center</span>
            </a>
            <a href="/dashboard/feedback" class="nav-link {% if page == 'feedback' %}active{% endif %}" data-page="feedback">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/></svg>
                <span>Feedback</span>
            </a>
        </nav>

        <div class="sidebar-divider"></div>

        <!-- Project selector -->
        <div class="px-4 py-3">
            <label class="text-[10px] text-cream/40 uppercase tracking-wider block mb-1.5">Active Project</label>
            <select id="projectSelect" class="project-select" onchange="DABO.switchProject(this.value)">
                <option value="">— Select —</option>
                {% for p in projects %}
                <option value="{{ p.id }}">{{ p.name }} (#{{ p.id }})</option>
                {% endfor %}
            </select>
        </div>

        <div class="sidebar-divider"></div>

        <!-- Stats footer -->
        <div class="px-5 py-3">
            <div class="flex justify-between items-center py-1 border-b border-white/5">
                <span class="text-[10px] text-cream/30 uppercase tracking-wider">Projects</span>
                <span class="text-sm font-bold text-orange">{{ project_count }}</span>
            </div>
            <div class="flex justify-between items-center py-1">
                <span class="text-[10px] text-cream/30 uppercase tracking-wider">Sheets</span>
                <span class="text-sm font-bold text-orange">{{ sheet_count }}</span>
            </div>
            <div class="mt-3 pt-2 border-t border-white/5 text-center">
                <span class="text-[9px] text-cream/20 tracking-wider">DABO v2.0</span>
            </div>
        </div>
    </aside>

    <!-- ═══ MAIN CONTENT ═══ -->
    <main class="flex-1 overflow-y-auto bg-gray-50" id="mainContent">
        <!-- Page content loaded here -->
        {% include "pages/" + page + ".html" %}
    </main>
</div>

<script src="{{ url_for('static', filename='js/app.js') }}"></script>
<script>
    // Restore selected project from localStorage
    const saved = localStorage.getItem('dabo_project_id');
    if (saved) {
        document.getElementById('projectSelect').value = saved;
    }
</script>
{% endblock %}
